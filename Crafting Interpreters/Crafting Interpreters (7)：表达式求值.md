# 7 表达式求值

对于语言实现来说，要执行源代码，可以将其编译为机器码，也可以编译为字节码由 VM 运行，或者编译为另一种语言，不过最简单的方式是直接执行语法树本身。

目前的解释器只支持表达式，而表达式最终会产生一个值，要计算一个表达式构成的语法树，需要对每一种表达式语法规定要如何计算出值，如字面量、操作符等。

## 7.1 值描述

在 Lox 中，值由字面量创建，由表达式计算，并存储在变量中，并将其视作 Lox 对象，但其底层使用 Ruby 写的，因此需要建立 Lox 到 Ruby 之间值的映射。

| Lox Type | Ruby Type |
| -------- | --------- |
| any      | object    |
| nil      | nil       |
| boolean  | boolean   |
| number   | float     |
| string   | string    |

可以看到，Ruby 本身的数据类型能够很方便的映射到 Lox 中。

## 7.2 表达式求值

在之前，已经使用访问者模式创建了一个 `AstPrinter`，实际上这就是递归遍历语法树，并最终返回一个构建的字符串，本质上就是在语法树上执行，但不是求值，而是连接字符串。因此创建一个 `AstInterpreter` 类，作为一个新的访问者用于求值。

### 7.2.1 字面量求值

