# 1 å¸¸è§é›†åˆ

Rust æ ‡å‡†åº“ä¸­æœ‰ä¸€ç³»åˆ—è¢«ç§°ä¸º**é›†åˆ**çš„æ•°æ®ç»“æ„ã€‚ä¸€èˆ¬çš„æ•°æ®ç±»å‹éƒ½ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„å€¼ï¼Œä½†é›†åˆå¯ä»¥åŒ…å«å¤šä¸ªå€¼ã€‚ä¸åŒäºå†…å»ºçš„æ•°ç»„å’Œå…ƒç»„ç±»å‹ï¼Œè¿™äº›é›†åˆæŒ‡å‘çš„æ•°æ®æ˜¯å‚¨å­˜åœ¨å †ä¸Šçš„ï¼Œå…¶æ•°æ®çš„æ•°é‡ä¸å¿…åœ¨ç¼–è¯‘æ—¶å°±å·²çŸ¥ï¼Œä¸”å¯ä»¥éšç€ç¨‹åºçš„è¿è¡ŒåŠ¨æ€å¢é•¿æˆ–ç¼©å°ã€‚

æ ‡å‡†åº“ `std::collections` ä¸­å«æœ‰æœ€å¸¸è§çš„é€šç”¨æ•°æ®ç»“æ„ï¼Œåˆ†ä¸ºå››å¤§ç±»ï¼š

-   Sequencesï¼š`Vec`ã€`VecDeque`ã€`LinkedList`
-   Mapsï¼š`HashMap`ã€`BTreeMap`
-   Setsï¼š`HashSet`ã€`BTreeSet`
-   Miscï¼š`BinaryHeap`

å…¶ä¸­å¹¿æ³›ä½¿ç”¨çš„ä¸‰ç§é›†åˆï¼š

-   vector å…è®¸é¡ºåºåœ°å‚¨å­˜æ•°é‡å¯å˜çš„å€¼ï¼›
-   å­—ç¬¦ä¸²æ˜¯å­—ç¬¦çš„é›†åˆï¼›
-   HashMap å…è®¸å°†å€¼ä¸ä¸€ä¸ªç‰¹å®šçš„é”®ç›¸å…³è”ã€‚

## vector

vector å…è®¸åœ¨ä¸€ä¸ªå•ç‹¬çš„æ•°æ®ç»“æ„ä¸­å‚¨å­˜å¤šäºä¸€ä¸ªçš„å€¼ï¼Œå®ƒä»¬åœ¨å†…å­˜ä¸­ç›¸é‚»åœ°æ’åˆ—ï¼Œä¸”ç±»å‹ç›¸åŒã€‚

### åˆ›å»º

ä½¿ç”¨ `new` å‡½æ•°æ¥åˆ›å»ºé•¿åº¦ä¸º 0 çš„ vectorã€‚

```rust
// ç”±äºæ²¡æœ‰åˆå§‹åŒ–ï¼Œéœ€è¦ç±»å‹æ³¨è§£
let v: Vec<i32> = Vec::new();
```

å¯ä»¥ä½¿ç”¨å®æ¥åˆ›å»ºå¹¶åˆå§‹åŒ– `Vec`ï¼Œå› ä¸ºæœ‰äº†åˆå§‹å€¼ï¼Œæ‰€ä»¥å¯ä»¥æ¨æ–­å‡ºç±»å‹ã€‚

```rust
let v1 = vec![1, 2, 3];
let v2 = vec![0; 5];
```

vector åœ¨å…¶ç¦»å¼€ä½œç”¨åŸŸæ—¶ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶ä¸¢å¼ƒæ‰€æœ‰å…ƒç´ ï¼š

```rust
{
    let v = vec![1, 2, 3];
}   // v è¢«ä¸¢å¼ƒ
```

### è¯»å–

ä½¿ç”¨ç´¢å¼•æˆ–è€… `get` æ–¹æ³•è¯»å– vector çš„å€¼ï¼š

```rust
let mut v = vec![1, 2, 3];
let v2 = &v[1];
match v.get(1) {
    Some(i) => println!("{i}"),
    None => println!("None")
}
```

æœ‰ä¸¤ç§è¯»å–æ–¹å¼çš„åŸå› æ˜¯ï¼Œå½“å°è¯•è·å–è¶…è¿‡ç´¢å¼•èŒƒå›´çš„å€¼æ—¶å¤„ç†ä¸åŒï¼š

```rust
let v = vec![1, 2, 3];
let e1 = &v[10];
let e2 = v.get(10);
```

å¯¹äº `[]` æ–¹æ³•ï¼Œå½“å¼•ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´ æ—¶ Rust ä¼šé€ æˆ panicã€‚è€Œ `get` æ–¹æ³•è¿”å›ä¸€ä¸ª `Option<T>`ï¼Œå½“è¢«ä¼ é€’äº†ä¸€ä¸ªæ•°ç»„å¤–çš„ç´¢å¼•æ—¶ï¼Œå®ƒä¸ä¼š panic è€Œæ˜¯è¿”å› `None`ã€‚

---

ä½¿ç”¨ `for` æ¥éå† vector ä¸­æ¯ä¸€ä¸ªå…ƒç´ ï¼š

```rust
let mut v = vec![1, 2, 3];
for i in &v {
    println!("{i}");
}

// éå†æ—¶ä¿®æ”¹
for i in &mut v {
    *i += 1;
    println!("{i}");
}
```

è‹¥åœ¨éå†æ—¶æ²¡æœ‰ä½¿ç”¨ vector çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿç§»åŠ¨ï¼Œæ­¤åä¸èƒ½å†ä½¿ç”¨è¯¥ vectorã€‚

```rust
for i in v {}
// v è¢«ç§»åŠ¨ï¼Œæ­¤å¤„ä¸èƒ½ä½¿ç”¨
```

---

vector ä¹Ÿæ˜¯å¯ä»¥ slice çš„ï¼Œä½¿ç”¨ `&` æˆ– `as_slice` æ–¹æ³•è·å¾—ä¸€ä¸ª sliceï¼š

```rust
let v = vec![1, 2, 3, 4, 5];
let s = &v[..3];
let s2 = v.as_slice();
```

### æ›´æ–°

å¯ä»¥é€šè¿‡ç´¢å¼•æ¥ä¿®æ”¹å€¼ï¼š

```rust
v[0] = 10;
```

---

`push` æ–¹æ³•å¢åŠ å…ƒç´ ï¼Œç”±äºå¯å˜ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ `mut`ï¼š

```rust
let mut v = Vec::new();
v.push(1);
v.push(2);
```

`insert` æ–¹æ³•ä»æŒ‡å®šç´¢å¼•æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥è¶…å‡ºç´¢å¼•ï¼Œåˆ™å‘ç”Ÿ panicï¼š

```rust
let mut v = vec![1, 2, 3];
v.insert(1, 4);
assert_eq!(v, [1, 4, 2, 3]);
vec.insert(4, 5);
assert_eq!(v, [1, 4, 2, 3, 5]);
```

---

`pop` æ–¹æ³•åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª `Option<T>`ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¤„ç†ä¸ºç©ºçš„æƒ…å†µï¼š

```rust
let mut v = vec![1, 2, 3];
let e: Option<i32> = v.pop();
```

`remove` æ–¹æ³•åˆ é™¤å¹¶è¿”å›æŒ‡å®šç´¢å¼•çš„å…ƒç´ ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¾æ¬¡å‘å‰ç§»åŠ¨ï¼Œè‹¥è¶…å‡ºç´¢å¼•ï¼Œåˆ™å‘ç”Ÿ panicï¼š

```rust
let mut v = vec![1, 2, 3];
assert_eq!(v.remove(1), 2);
assert_eq!(v, [1, 3]);
```

ç”±äº `remove` æ–¹æ³•ä¼šç§»åŠ¨å…ƒç´ ï¼Œå› æ­¤ä¼šå½±å“æ•ˆç‡ï¼Œè‹¥ä¸å…³å¿ƒå…ƒç´ çš„é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨ `swap_remove` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæŠŠæœ€åä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°è¢«åˆ é™¤çš„ä½ç½®ä¸Šï¼š

```rust
let mut v = vec![1, 2, 3, 4];
assert_eq!(v.swap_remove(1), 2);
assert_eq!(v, [1, 4, 3]);
```

`dedup` æ–¹æ³•åˆ é™¤**è¿ç»­é‡å¤**çš„å…ƒç´ ï¼Œå¦‚æœå·²ç»æ’å¥½åºï¼Œåˆ™ä¼šåˆ é™¤æ‰€æœ‰é‡å¤çš„å…ƒç´ ï¼š

```rust
let mut v = vec![1, 2, 2, 3, 3, 2, 4, 2, 5, 5];
v.dedup();
assert_eq!(v, [1, 2, 3, 2, 4, 2, 5]);
```

`clear` æ–¹æ³•æ¸…ç©ºæ‰€æœ‰å…ƒç´ ï¼Œ`is_empty` åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œæ¸…ç©ºå³å°†é•¿åº¦å˜ä¸º 0ï¼Œä½†å®¹é‡ä¾ç„¶å­˜åœ¨ï¼š

```rust
let mut v = vec![0; 5];
v.clear();
assert!(v.is_empty());
```

---

`split_off` æ–¹æ³•ä»æŒ‡å®šç´¢å¼•å¤„å°† vector åˆ†å‰²æˆä¸¤ä¸ª vectorï¼Œè‹¥è¶…å‡ºç´¢å¼•ï¼Œåˆ™å‘ç”Ÿ panicï¼š

```rust
let mut v = vec![1, 2, 3];
let v2 = v.split_off(1);
assert_eq!(v, [1]);
assert_eq!(v2, [2, 3]);
```

### é‡æ–°åˆ†é…

vector æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŒ…å«æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡çš„å˜é‡ï¼Œä¸”ä¿è¯è¯¥æŒ‡é’ˆæŒ‡å‘çš„å€¼æ˜¯æœ‰æ•ˆçš„ã€‚

![vector æ„æˆ](https://raw.githubusercontent.com/genskyff/image-hosting/main/images/202203270427221.png)

é•¿åº¦æŒ‡å®é™…çš„å…ƒç´ æ•°é‡ï¼Œå®¹é‡ä¸ºå®é™…åˆ†é…çš„å†…å­˜å¤§å°ï¼Œå…¶ä¸­ `uninit` è¡¨ç¤ºæœªè¢«åˆå§‹åŒ–çš„å†…å­˜ã€‚è‹¥é•¿åº¦è¶…è¿‡äº†å®¹é‡ï¼Œé‚£ä¹ˆå®¹é‡ä¼šè‡ªåŠ¨å¢åŠ ï¼Œä½†å› ä¸º vector ä¿è¯å…ƒç´ æ˜¯åœ¨å†…å­˜ä¸­è¿ç»­åˆ†é…çš„ï¼Œè‹¥åœ¨å½“å‰ä½ç½®è¿›è¡Œå¢åŠ ä½†æ— æ³•æ»¡è¶³è¿™ä¸ªè¦æ±‚ï¼Œåˆ™ä¼šåœ¨å †ä¸Šé‡æ–°å¯»æ‰¾ç©ºé—´ï¼Œå¹¶æŠŠæ•°æ®æ‹·è´è¿‡å»ï¼Œè¿™ç§°ä¸º**é‡æ–°åˆ†é…**ã€‚è¿™æ—¶è‹¥æœ‰ä¸€ä¸ªè¯¥ vector å¼•ç”¨ï¼Œä½†é‡æ–°åˆ†é…åï¼Œè¯¥ vector å·²ç»ä¸åœ¨åŸæ¥çš„ä½ç½®ä¸Šï¼Œç›¸å½“äºæŒ‡å‘äº†è¢«é‡Šæ”¾çš„å†…å­˜ï¼Œè¿™è¿åäº†å¼•ç”¨æ€»æ˜¯æœ‰æ•ˆçš„åŸåˆ™ï¼Œäºæ˜¯ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚

```rust
let mut v = vec![1, 2, 3];
let e = &v[0];
v.push(4);     // é”™è¯¯ï¼Œä¸èƒ½åœ¨ç›¸åŒä½œç”¨åŸŸä¸­åŒæ—¶å­˜åœ¨å¯å˜å’Œä¸å¯å˜å¼•ç”¨
```

å½“å‘ç”Ÿäº†é‡æ–°åˆ†é…çš„æƒ…å†µï¼Œç”±äºéœ€è¦åœ¨å †ä¸­é‡æ–°åˆ†é…å†…å­˜å¹¶è¿›è¡Œæ‹·è´æ“ä½œï¼Œå› æ­¤ä¼šå½±å“æ•ˆç‡ï¼Œè‹¥èƒ½ç¡®å®š vector å¯èƒ½çš„å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨ `Vec::with_capacity` æ¥æŒ‡å®šé¢„æœŸå¤§å°ï¼Œè¿˜å¯ä½¿ç”¨ `as_ptr`ã€`len` å’Œ `capacity` æ–¹æ³•æ¥è·å– vector çš„æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡ã€‚

```rust
let mut v = Vec::with_capacity(10);
assert_eq!(v.len(), 0);
assert_eq!(v.capacity(), 10);
println!("{:?}", v.as_ptr());
for i in 0..10 {
    v.push(i);
}
assert_eq!(v.len(), 10);
assert_eq!(v.capacity(), 10);
```

### å­˜å‚¨æšä¸¾

vector åªèƒ½å‚¨å­˜ç›¸åŒç±»å‹çš„å€¼ï¼Œå½“éœ€è¦åœ¨ vector ä¸­å‚¨å­˜ä¸åŒç±»å‹å€¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æšä¸¾ï¼Œå› ä¸ºæšä¸¾å€¼è¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªç±»å‹ã€‚

```rust
enum ShoesSize {
    Cm(f64),
    Eur(i32)
}

let sizes = vec![
    ShoesSize::Cm(27.5),
    ShoesSize:Eur(43)
];
```

## å­—ç¬¦ä¸²

Rust åªæœ‰ä¸€ç§å­—ç¬¦ä¸²ç±»å‹ï¼š`&str`ï¼Œå³å­—ç¬¦ä¸² sliceï¼Œå®ƒæ˜¯ä¸€äº›å‚¨å­˜åœ¨åˆ«å¤„çš„ UTF-8 ç¼–ç å­—ç¬¦ä¸²æ•°æ®çš„å¼•ç”¨ã€‚

`String` ç±»å‹æ˜¯ç”±æ ‡å‡†åº“æä¾›çš„ï¼Œå®ƒæ˜¯å¯å¢é•¿çš„ã€å¯å˜çš„ã€æœ‰æ‰€æœ‰æƒçš„ã€UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œæ˜¯ `Vec<u8>` çš„å°è£…ï¼Œå› æ­¤å’Œ vector ç›¸åŒï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡ï¼Œä¹Ÿå…·æœ‰ vector çš„æ€§è´¨ï¼Œå¦‚æ·»åŠ å…ƒç´ æ—¶ï¼Œä¹Ÿå¯èƒ½ä¼šé‡æ–°åˆ†é…ã€‚

### åˆ›å»º

æœ‰å¤šç§æ–¹æ³•åˆ›å»º Stringï¼š

-   `to_string` æ–¹æ³•å°† `&str` è½¬æ¢æˆ `String`ï¼›
-   `new` å‡½æ•°åˆ›å»ºç©º Stringï¼›
-   `from` å‡½æ•°åˆ›å»ºæŒ‡å®š Stringï¼›
-   `from_utf8` å‡½æ•°åˆ›å»ºæ¥è‡ª UTF-8 å­—èŠ‚ vector çš„ Stringï¼›
-   `with_capacity` å‡½æ•°åˆ›å»ºæŒ‡å®šå®¹é‡å¤§å°ä¸”é•¿åº¦ä¸º 0 çš„å­—ç¬¦ä¸²ã€‚

```rust
let s = "hello".to_string();
let s = String::new();
let s = String::from("hello");
// "ğŸ˜…" çš„ UTF-8 ç¼–ç ä¸º 0xf0, 0x9f, 0x98, 0x85
let s = String::from_utf8(vec![0xf0, 0x9f, 0x98, 0x85]).unwrap();
let s = String::with_capacity(10);
```

`from_utf8` å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª `Result`ï¼Œç”¨äºæ£€æŸ¥ç»™å®šçš„ UTF-8 å­—èŠ‚æ˜¯å¦æœ‰æ•ˆã€‚

```rust
let s = String::from_utf8(vec![0xf0, 0x9f, 0x18, 0x85]);
let s = match s {
    Ok(s) => s,
    Err(_) => "vaild utf-8 code".to_string(),
};
```

å¯ä»¥ä½¿ç”¨ `from_utf8_lossy` åˆ›å»ºæ¥è‡ª UTF-8 å­—èŠ‚ vector çš„ Stringï¼Œä¸”åŒ…æ‹¬æ— æ•ˆå­—èŠ‚ã€‚

```rust
let s = b"Hello \xF0\x90\x80World";
let s = String::from_utf8_lossy(s);
assert_eq!("Hello ï¿½World", s);
```

åŒç†ï¼Œ`from_utf16` å’Œ `from_utf16_lossy` å‡½æ•°åˆ™åˆ›å»ºæ¥è‡ª UTF-16 å­—èŠ‚ vector çš„ Stringã€‚

### è¯»å–

åœ¨ Rust ä¸­ï¼Œä½¿ç”¨ç´¢å¼•è¯­æ³•è®¿é—® `String` çš„ä¸€éƒ¨åˆ†ï¼Œä¼šå‡ºç°ä¸€ä¸ªé”™è¯¯ã€‚

```rust
let s1 = String::from("hello");
let h = s1[0];	// é”™è¯¯
```

åœ¨ Rust ä¸­ï¼Œ`String` æ˜¯ä¸€ä¸ª `Vec<u8>` çš„å°è£…ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ `as_ptr`ã€`len` å’Œ `capacity` æ–¹æ³•æ¥æŸ¥çœ‹æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡ï¼š

```rust
let s = String::from("Hola");
println!("{:?}", s.as_ptr());
assert_eq!(s.len(), 4);
assert_eq!(s.capacity(), 4);
```

å­—ç¬¦ä¸² `Hola` çš„é•¿åº¦å’Œå®¹é‡éƒ½æ˜¯ 4ï¼Œè¯¥å­—ç¬¦ä¸²æ¯ä¸€ä¸ªå­—æ¯çš„ UTF-8 ç¼–ç éƒ½å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚

```rust
let s = String::from("Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ");
assert_eq!(s.len(), 24);
```

è¿™é‡Œçš„é•¿åº¦æ˜¯ 24ï¼Œè¿™æ˜¯ä½¿ç”¨ UTF-8 ç¼–ç  `Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ` æ‰€éœ€è¦çš„å­—èŠ‚æ•°ï¼Œè¯¥å­—ç¬¦ä¸²æ¯ä¸€ä¸ªå­—æ¯çš„ UTF-8 ç¼–ç éƒ½å ç”¨ä¸¤ä¸ªå­—èŠ‚ã€‚

å­—ç¬¦ä¸²ä¸æ”¯æŒç´¢å¼•ï¼Œå› ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å­—èŠ‚å€¼çš„ç´¢å¼•å¹¶ä¸æ€»æ˜¯å¯¹åº”ä¸€ä¸ªæœ‰æ•ˆçš„ Unicode æ ‡é‡å€¼ã€‚

```rust
let s = "Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ";
let c = &s[0];  // é”™è¯¯
```

å½“ä½¿ç”¨ UTF-8 ç¼–ç æ—¶ï¼Œ`Ğ—` çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ `208`ï¼Œç¬¬äºŒä¸ªæ˜¯ `151`ï¼Œæ‰€ä»¥ `c` çš„å€¼ä¸º `208`ï¼Œä½† `208` è‡ªèº«å¹¶ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å­—æ¯ã€‚ä¸ºäº†é¿å…è¿”å›æ„å¤–çš„å€¼å¹¶é€ æˆä¸èƒ½ç«‹åˆ»å‘ç°çš„ bugï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ã€‚

---

Rust ä¸­ï¼Œæœ‰ä¸‰ç§ç›¸å…³æ–¹å¼çš„å­—ç¬¦ä¸²ç†è§£ï¼š**å­—èŠ‚**ã€**æ ‡é‡å€¼**å’Œ**å­—å½¢ç°‡**ã€‚

```
[224, 164, 168, 224, 164, 174, 224, 164, 184, 224, 165, 141, 224, 164, 164, 224, 165, 135]
```

è¿™äº›æ˜¯ç”¨æ¢µæ–‡ä¹¦å†™çš„å°åº¦è¯­å•è¯ `à¤¨à¤®à¤¸à¥à¤¤à¥‡` å‚¨å­˜åœ¨ vector ä¸­çš„ `u8` å€¼ã€‚

è¿™é‡Œæœ‰ 18 ä¸ªå­—èŠ‚ï¼Œæ˜¯è®¡ç®—æœºæœ€ç»ˆä¼šå‚¨å­˜çš„æ•°æ®ã€‚è‹¥ä» Unicode æ ‡é‡å€¼çš„è§’åº¦ç†è§£ï¼Œå³ Rust çš„ `char` ç±»å‹ï¼Œåˆ™ä¸ºå¦‚ä¸‹å­—ç¬¦ï¼š

```text
['à¤¨', 'à¤®', 'à¤¸', 'à¥', 'à¤¤', 'à¥‡']
```

è¿™é‡Œæœ‰å…­ä¸ª `char`ï¼Œä¸è¿‡ç¬¬å››ä¸ªå’Œç¬¬å…­ä¸ªéƒ½ä¸æ˜¯å­—æ¯ï¼Œå®ƒä»¬æ˜¯å‘éŸ³ç¬¦å·ï¼Œæœ¬èº«å¹¶æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œéœ€è¦å’Œå…¶å®ƒå­—æ¯ç»„åˆèµ·æ¥æ‰èƒ½å½¢æˆä¸€ä¸ªå®Œæ•´çš„å­—æ¯ï¼Œä¹Ÿå°±æ˜¯å­—å½¢ç°‡ã€‚å¦‚æœä»¥å­—å½¢ç°‡çš„è§’åº¦ç†è§£ï¼Œå°±ä¼šå¾—åˆ°æ„æˆè¿™ä¸ªå•è¯çš„å››ä¸ªå­—æ¯ï¼š

```text
["à¤¨", "à¤®", "à¤¸à¥", "à¤¤à¥‡"]
```

Rust ä¸å…è®¸ä½¿ç”¨ç´¢å¼•è·å– `String` å­—ç¬¦çš„å¦ä¸€ä¸ªåŸå› æ˜¯ï¼Œç´¢å¼•æ“ä½œé¢„æœŸæ€»æ˜¯éœ€è¦å¸¸æ•°æ—¶é—´ O(1)ï¼Œä½†æ˜¯å¯¹äº `String` å¿…é¡»ä»å¼€å¤´åˆ°ç´¢å¼•ä½ç½®éå†æ¥ç¡®å®šæœ‰å¤šå°‘æœ‰æ•ˆçš„å­—ç¬¦ï¼Œå› æ­¤ä¸èƒ½ä¿è¯æ€§èƒ½ã€‚

#### ç´¢å¼•å­—ç¬¦ä¸² slice

å¯¹äº `&str` ç±»å‹å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œä½†æ˜¯è¿”å›çš„ç±»å‹æ˜¯ä¸æ˜ç¡®çš„ï¼šå­—èŠ‚å€¼ã€å­—ç¬¦ã€å­—å½¢ç°‡æˆ–å­—ç¬¦ä¸² sliceã€‚å¯ä»¥ä½¿ç”¨ `[]` å’Œä¸€ä¸ª range æ¥åˆ›å»ºå«ç‰¹å®šå­—èŠ‚çš„å­—ç¬¦ä¸² sliceã€‚

```rust
let s = "Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ";
let s1 = String::from("ä½ å¥½");
let s = &s[..4];
let s1 = &s[3..];
```

è¿™é‡Œï¼Œ`s` ä¼šæ˜¯ä¸€ä¸ª `&str`ï¼Œå®ƒåŒ…å«å­—ç¬¦ä¸²çš„å¤´å››ä¸ªå­—èŠ‚ï¼Œå³ `s` å°†ä¼šæ˜¯ `Ğ—Ğ´`ï¼Œä½†è·å– `&s[0..1]` æ—¶ï¼ŒRust ä¼šåœ¨è¿è¡Œæ—¶ panicï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ— æ•ˆçš„å­—ç¬¦ã€‚

è¿˜å¯ä»¥ç”¨ `get` æ–¹æ³•æ¥è·å–å€¼ï¼Œé€šè¿‡ä¼ é€’ä¸€ä¸ª rangeï¼Œè¿”å›ä¸€ä¸ª `Option`ï¼Œç”¨äºæ£€æµ‹å€¼æ˜¯å¦å­˜åœ¨ï¼š

```rust
let s = String::from("ä½ å¥½");
assert_eq!(Some("å¥½"), s.get(3..6));
```

### éå†

è·å–å•ç‹¬çš„ Unicode æ ‡é‡å€¼ï¼Œæ— è®ºæ˜¯ `&str` è¿˜æ˜¯ `String`ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ `chars` æ–¹æ³•ã€‚å¯¹ `à¤¨à¤®à¤¸à¥à¤¤à¥‡` è°ƒç”¨ `chars` æ–¹æ³•ä¼šå°†å…¶åˆ†å¼€å¹¶è¿”å›å…­ä¸ª `char` ç±»å‹çš„å€¼ï¼Œæ¥ç€å°±å¯ä»¥éå†å…¶ç»“æœæ¥è®¿é—®æ¯ä¸€ä¸ªå…ƒç´ ã€‚

```rust
for c in "à¤¨à¤®à¤¸à¥à¤¤à¥‡".chars() {
    println!("{}", c);
}
```

`bytes` æ–¹æ³•è¿”å›ä¸€ä¸ª Bytes ç±»å‹çš„å­—ç¬¦ä¸² slice è¿­ä»£å™¨ã€‚

```rust
for b in "à¤¨à¤®à¤¸à¥à¤¤à¥‡".bytes() {
    println!("{}", b);
}
```

>   ä»å­—ç¬¦ä¸²ä¸­è·å–å­—å½¢ç°‡æ˜¯å¾ˆå¤æ‚çš„ï¼Œæ‰€ä»¥æ ‡å‡†åº“å¹¶æ²¡æœ‰æä¾›è¿™ä¸ªåŠŸèƒ½ã€‚

### æ›´æ–°

`String` çš„å†…å®¹å¯ä»¥æ”¹å˜ã€‚ä½¿ç”¨ `+` æˆ– `format!` å®æ¥æ‹¼æ¥ `String` å€¼ã€‚

```rust
let s1 = String::from("Hello, ");
let s2 = String::from("world!");
let s3 = s1 + &s2;   // s1 è¢«ç§»åŠ¨äº†ï¼Œä¸èƒ½ç»§ç»­ä½¿ç”¨
```

`s1` åœ¨ç›¸åŠ åä¸å†æœ‰æ•ˆçš„åŸå› ï¼Œå’Œä½¿ç”¨ `s2` çš„å¼•ç”¨çš„åŸå› ï¼Œä¸ä½¿ç”¨ `+` è¿ç®—ç¬¦æ—¶è°ƒç”¨çš„å‡½æ•°ç­¾åæœ‰å…³ã€‚

`+` è¿ç®—ç¬¦ä½¿ç”¨äº† `add` å‡½æ•°ï¼Œå…¶å‡½æ•°ç­¾åç±»ä¼¼ï¼š

```rust
fn add(self, s: &str) -> String {
```

è¿™å¹¶ä¸æ˜¯æ ‡å‡†åº“ä¸­å®é™…çš„ç­¾åï¼Œæ ‡å‡†åº“ä¸­çš„ `add` ä½¿ç”¨æ³›å‹å®šä¹‰ã€‚è¿™é‡Œ `add` çš„ç­¾åä½¿ç”¨å…·ä½“ç±»å‹ä»£æ›¿äº†æ³›å‹ã€‚

é¦–å…ˆï¼Œ`s2` ä½¿ç”¨äº† `&`ï¼Œä½¿ç”¨ç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„**å¼•ç”¨**ä¸ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ç›¸åŠ ã€‚è¿™æ˜¯å› ä¸º `add` å‡½æ•°çš„ `s` å‚æ•°ï¼šåªèƒ½å°† `&str` å’Œ `String` ç›¸åŠ ï¼Œä¸èƒ½å°†ä¸¤ä¸ª `String` ç›¸åŠ ã€‚

èƒ½å¤Ÿåœ¨ `add` è°ƒç”¨ä¸­ä½¿ç”¨ `&s2` æ˜¯å› ä¸º `&String` å¯ä»¥è¢«**å¼ºè½¬**æˆ `&str`ã€‚å½“ `add` å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼ŒRust ä½¿ç”¨äº† **Deref å¼ºåˆ¶è½¬æ¢**ï¼Œå³æŠŠ `&s2` å˜æˆäº† `&s2[..]`ã€‚å› ä¸º `add` æ²¡æœ‰è·å–å‚æ•°çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥ `s2` åœ¨è¿™ä¸ªæ“ä½œåä»ç„¶æ˜¯æœ‰æ•ˆçš„ `String`ã€‚

å…¶æ¬¡ï¼Œ`add` è·å–äº† `self` çš„æ‰€æœ‰æƒï¼Œå› ä¸º `self` **æ²¡æœ‰**ä½¿ç”¨ `&`ã€‚`s1` çš„æ‰€æœ‰æƒå°†è¢«ç§»åŠ¨åˆ° `add` è°ƒç”¨ä¸­ï¼Œä¹‹åå°±ä¸å†æœ‰æ•ˆã€‚è™½ç„¶çœ‹èµ·æ¥åƒå¤åˆ¶ä¸¤ä¸ªå­—ç¬¦ä¸²å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œè€Œå®é™…ä¸Šè¿™ä¸ªè¯­å¥ä¼šè·å– `s1` çš„æ‰€æœ‰æƒï¼Œé™„åŠ ä¸Šä» `s2` ä¸­æ‹·è´çš„å†…å®¹ï¼Œå¹¶è¿”å›ç»“æœçš„æ‰€æœ‰æƒï¼Œè¿™ä¸ªå®ç°æ¯”æ‹·è´è¦æ›´é«˜æ•ˆã€‚

çº§è”å¤šä¸ªå­—ç¬¦ä¸²ï¼Œ`+` çš„è¡Œä¸ºå°±ååˆ†ç¹çï¼š

```rust
let s1 = String::from("tic");
let s2 = String::from("tac");
let s3 = String::from("toe");
let s = s1 + "-" + &s2 + "-" + &s3;
```

å¯¹æ­¤å¯ä»¥ä½¿ç”¨ `format!` å®ï¼š

```rust
let s1 = String::from("tic");
let s2 = String::from("tac");
let s3 = String::from("toe");
let s = format!("{}-{}-{}", s1, s2, s3);
```

`format!` ä¸ `println!` çš„å·¥ä½œåŸç†ç›¸åŒï¼Œä¸è¿‡å®ƒä¸æŠŠè¾“å‡ºæ‰“å°åˆ°å±å¹•ä¸Šï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªå¸¦æœ‰ç»“æœå†…å®¹çš„ `String`ï¼Œä¸”ä¸ä¼šè·å–ä»»ä½•å‚æ•°çš„æ‰€æœ‰æƒã€‚

---

`push` æ–¹æ³•é™„åŠ å•ç‹¬çš„å­—ç¬¦ï¼š

```rust
let mut s = String::from("lo");
s.push('l');
```

`push_str` æ–¹æ³•é™„åŠ å­—ç¬¦ä¸² sliceï¼š

```rust
let mut s = String::from("foo");
s.push_str("bar");
```

`insert` æ–¹æ³•ä»æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œè‹¥è¯¥ä½ç½®ä¸åœ¨ UTF-8 è¾¹ç•Œæˆ–è¶…å‡ºèŒƒå›´ï¼Œåˆ™å‘ç”Ÿ panicï¼š

```rust
let mut s = String::from("ä½ å¥½");
s.insert(0, '0');
s.insert(4, '4');
s.insert(8, '8');
assert_eq!("0ä½ 4å¥½8", s);
```

`insert_str` æ–¹æ³•ä»æŒ‡å®šä½ç½®æ’å…¥å­—ç¬¦ä¸² sliceï¼Œè‹¥è¯¥ä½ç½®ä¸åœ¨ UTF-8 è¾¹ç•Œæˆ–è¶…å‡ºèŒƒå›´ï¼Œåˆ™å‘ç”Ÿ panicï¼š

```rust
let mut s = String::from("ä½ å¥½");
s.insert_str(0, "å“ˆå“ˆï¼Œ");
s.insert_str(15, "ï¼Œå†è§");
assert_eq!("å“ˆå“ˆï¼Œä½ å¥½ï¼Œå†è§", s);
```

---

`pop` æ–¹æ³•åˆ é™¤æœ€åä¸€ä¸ªå­—ç¬¦å¹¶è¿”å›è¯¥å­—ç¬¦ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª `Option`ï¼š

```rust
let mut s = String::from("foo");
assert_eq!(s.pop(), Some('o'));
assert_eq!(s, "fo");
```

`remove` æ–¹æ³•åˆ é™¤æŒ‡å®šä½ç½®çš„å­—ç¬¦å¹¶è¿”å›å®ƒï¼Œè‹¥è¯¥ä½ç½®ä¸åœ¨ UTF-8 è¾¹ç•Œæˆ–è¶…å‡ºèŒƒå›´ï¼Œåˆ™å‘ç”Ÿ panicï¼š

```rust
let mut s = String::from("ä½ å¥½");
assert_eq!(s.remove(0), 'ä½ ');
assert_eq!(s.remove(0), 'å¥½');

let mut s = String::from("ä½ å¥½");
assert_eq!(s.remove(3), 'å¥½');
```

`clear` æ–¹æ³•æ¸…ç©ºå­—ç¬¦ä¸²ï¼Œ`is_empty` æ–¹æ³•åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œæ¸…ç©ºå³å°†é•¿åº¦å˜ä¸º 0ï¼Œä½†å®¹é‡ä¾ç„¶å­˜åœ¨ï¼š

```rust
let mut s = String::from("foo");
s.clear();
assert!(s.is_empty());
```

---

`split_off` æ–¹æ³•ä»æŒ‡å®šä½ç½®å°†åŸå­—ç¬¦ä¸²åˆ†å‰²æˆä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œè‹¥è¯¥ä½ç½®ä¸åœ¨ UTF-8 è¾¹ç•Œæˆ–è¶…å‡ºèŒƒå›´ï¼Œåˆ™å‘ç”Ÿ panicï¼š

```rust
let mut s = String::from("ä½ å¥½ï¼Œä¸–ç•Œ");
let s2 = s.split_off(6);
assert_eq!(s, "ä½ å¥½");
assert_eq!(s2, "ï¼Œä¸–ç•Œ");
```

`replace` æ–¹æ³•ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²æ›¿æ¢åŒ¹é…é¡¹ï¼ŒåŒ¹é…é¡¹å¯ä»¥æ˜¯æ¨¡å¼ï¼Œè‹¥ä¸åŒ¹é…ï¼Œåˆ™ä¸æ›¿æ¢ï¼š

```rust
let s = "this is old";
assert_eq!("this is new", s.replace("old", "new"));
```

`replacen` æ–¹æ³•ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²æ›¿æ¢å‰ N ä¸ªåŒ¹é…é¡¹ï¼ŒåŒ¹é…é¡¹å¯ä»¥æ˜¯æ¨¡å¼ï¼Œè‹¥ä¸åŒ¹é…ï¼Œåˆ™ä¸æ›¿æ¢ï¼š

```rust
let s = "foo foo 123 foo";
assert_eq!("new new 123 foo", s.replacen("foo", "new", 2));
assert_eq!("foo foo new23 foo", s.replacen(char::is_numeric, "new", 1));
```

### å…¶ä»–æ“ä½œ

`into_bytes` æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º `Vec<u8>`ï¼Œä¸”ä¼šè·å–æ‰€æœ‰æƒï¼Œå› æ­¤ä½¿ç”¨ååŸ String ä¸å¯ç”¨ï¼š

```rust
let s = String::from("hello");
let bytes = s.into_bytes();
assert_eq!(&[104, 101, 108, 108, 111][..], &bytes[..]);
s;    // s åœ¨æ­¤å¤„ä¸å¯ç”¨
```

`as_bytes` æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º `&[u8] `ï¼š

```rust
let s = String::from("hello");
assert_eq!(&[104, 101, 108, 108, 111], s.as_bytes());
```

`as_str` æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦ä¸² sliceï¼š

```rust
let s = String::from("foo");
assert_eq!("foo", s.as_str());
```

---

`to_lowercase` å’Œ `to_uppercase` æ–¹æ³•åˆ†åˆ«è¿”å›å­—ç¬¦ä¸²çš„å°å†™å’Œå¤§å†™å½¢å¼ï¼Œæ²¡æœ‰å¤§å°å†™çš„å­—ç¬¦ä¸ä¼šæ”¹å˜ï¼š

```rust
let s = "HELLO";
let s2 = "world";
assert_eq!("hello", s.to_lowercase());
assert_eq!("WORLD", s2.to_uppercase());

let s = "å“ˆå“ˆ";
assert_eq!(s, s.to_lowercase());
```

---

`repeat` æ–¹æ³•é‡å¤å­—ç¬¦ä¸² N æ¬¡å¹¶å°†å…¶è¿”å›ï¼Œå½“è¶…å‡º usize::MAX æ—¶ï¼Œåˆ™å‘ç”Ÿ panicï¼š

```rust
assert_eq!("abc".repeat(4), String::from("abcabcabcabc"));
```

---

`parse` æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¦ä¸€ç§æŒ‡å®šçš„ç±»å‹ï¼Œå¹¶è¿”å›ä¸€ä¸ª `Result`ï¼Œç”¨äºæ£€æŸ¥æ˜¯å¦æˆåŠŸè½¬æ¢ï¼š

```rust
let four = "4".parse::<u32>();
match four {
    Ok(i) => println!("{}", i),
    Err(_) => println!("Not a number"),
}
```

---

`trim`ã€`trim_start` å’Œ `trim_end` æ–¹æ³•åˆ†åˆ«è¿”å›åˆ é™¤äº†ä¸¤ç«¯ã€å¼€å¤´å’Œç»“å°¾ä½ç½®çš„ç©ºç™½å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼š

```rust
let s = "\tHello\tworld\t";
assert_eq!("Hello\tworld", s.trim());
assert_eq!("Hello\tworld\t", s.trim_start());
assert_eq!("\tHello\tworld", s.trim_end());
```

---

`find` æ–¹æ³•è¿”å›æ¨¡å¼åŒ¹é…çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•çš„ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª `Option`ï¼Œç”¨äºæ£€æŸ¥æ˜¯å¦åŒ¹é…æˆåŠŸï¼š

```rust
let s = "ä½ å¥½ï¼Œä¸–ç•Œï¼Œhello world";
assert_eq!(s.find('ä½ '), Some(0));
assert_eq!(s.find('ï¼Œ'), Some(6));
assert_eq!(s.find(char::is_lowercase), Some(18));
assert_eq!(s.find("å“ˆå“ˆ"), None);
```

---

`split` æ–¹æ³•è¿”å›ä¸€ä¸ªç”±æŒ‡å®šæ¨¡å¼åŒ¹é…åˆ†å‰²çš„å­—ç¬¦ä¸²çš„ slice è¿­ä»£å™¨ã€‚

```rust
let iter = "Mary had a little lamb".split(' ');
assert_eq!(iter.collect::<Vec<&str>>(), ["Mary", "had", "a", "little", "lamb"]);
```

`split_whitespace` æ–¹æ³•è¿”å›ä¸€ä¸ªç”±ç©ºç™½ç¬¦åˆ†å‰²çš„å­—ç¬¦ä¸² slice è¿­ä»£å™¨ã€‚

```rust
let iter = "A few words".split_whitespace();
assert_eq!(iter.collect::<Vec<&str>>(), ["A", "few", "words"]);
```

## å“ˆå¸Œ map

`HashMap` ç±»å‹å‚¨å­˜äº†ä¸€ä¸ªé”®ç±»å‹ `K` å¯¹åº”ä¸€ä¸ªå€¼ç±»å‹ `V` çš„æ˜ å°„ã€‚å®ƒé€šè¿‡ **Hash å‡½æ•°**æ¥å®ç°æ˜ å°„ï¼Œå†³å®šå¦‚ä½•å°†é”®å’Œå€¼æ”¾å…¥å†…å­˜ä¸­ã€‚å¯ä»¥ç”¨äºéœ€è¦ä»»ä½•ç±»å‹ä½œä¸ºé”®æ¥å¯»æ‰¾æ•°æ®çš„æƒ…å†µï¼Œè€Œä¸æ˜¯åƒ vector é‚£æ ·é€šè¿‡ç´¢å¼•ã€‚åŒæ—¶å…·æœ‰ç±»ä¼¼ vector çš„æ€§è´¨ï¼Œå¦‚é•¿åº¦ã€å®¹é‡å’Œé‡æ–°åˆ†é…ã€‚

### åˆ›å»º

ä½¿ç”¨ `new` æ–¹æ³•åˆ›å»ºä¸€ä¸ªç©ºçš„ `HashMap`ï¼Œå¹¶ä½¿ç”¨ `insert` æ–¹æ³•å¢åŠ å…ƒç´ ã€‚

```rust
use std::collections::HashMap;
let mut scores = HashMap::new();
scores.insert(String::from("Red"), 10);
scores.insert(String::from("Green"), 20);
```

éœ€è¦ `use` æ ‡å‡†åº“ä¸­é›†åˆéƒ¨åˆ†çš„ `HashMap`ï¼Œå› ä¸ºæ²¡æœ‰è¢« prelude è‡ªåŠ¨å¼•ç”¨ã€‚

å“ˆå¸Œ map å°†çš„æ•°æ®å‚¨å­˜åœ¨å †ä¸Šï¼Œè¿™ä¸ª `HashMap` çš„é”®ç±»å‹æ˜¯ `String` è€Œå€¼ç±»å‹æ˜¯ `i32`ï¼Œæ‰€æœ‰çš„é”®å¿…é¡»æ˜¯ç›¸åŒç±»å‹ï¼Œå€¼ä¹Ÿå¿…é¡»éƒ½æ˜¯ç›¸åŒç±»å‹ã€‚

---

è¿˜å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå…ƒç»„çš„ vector çš„ `collect` æ–¹æ³•ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç»„åŒ…å«ä¸€ä¸ªé”®å€¼å¯¹ã€‚`collect` æ–¹æ³•å¯ä»¥å°†æ•°æ®æ”¶é›†è¿›ä¸€ç³»åˆ—çš„é›†åˆç±»å‹ï¼Œä½¿ç”¨ `zip` æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå…ƒç»„çš„ vectorã€‚

```rust
let teams = vec![String::from("Red"), String::from("Green")];
let init_scores= vec![10, 20];
let scores: HashMap<_, _> = teams.iter().zip(init_scores.iter()).collect();
```

`HashMap<_, _>` éœ€è¦ç±»å‹æ³¨è§£ï¼Œå› ä¸º `collect` æœ‰å¾ˆå¤šä¸åŒçš„æ•°æ®ç»“æ„ï¼Œè€Œé™¤éæ˜¾å¼æŒ‡å®šå¦åˆ™æ— æ³•è¿›è¡Œç±»å‹æ¨æ–­ã€‚ä½†æ˜¯å¯¹äºé”®å’Œå€¼çš„ç±»å‹å‚æ•°æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿å ä½ï¼ŒRust èƒ½å¤Ÿæ ¹æ® vector ä¸­æ•°æ®çš„ç±»å‹æ¨æ–­å‡º `HashMap` æ‰€åŒ…å«çš„ç±»å‹ã€‚

---

è¿˜èƒ½ä½¿ç”¨ `from` æ–¹æ³•ï¼Œå°†å…ƒç»„ä½œä¸ºæ•°ç»„çš„å…ƒç´ è¿›è¡Œåˆå§‹åŒ–ï¼š

```rust
let solar_distance = HashMap::from([
    ("Mercury", 0.4),
    ("Venus", 0.7),
    ("Earth", 1.0),
    ("Mars", 1.5),
]);
```

#### æ‰€æœ‰æƒ

å¯¹äºåƒ `i32` è¿™æ ·çš„ `Copy` trait çš„ç±»å‹ï¼Œå…¶å€¼å¯ä»¥æ‹·è´è¿›å“ˆå¸Œ mapã€‚å¯¹äºåƒ `String` è¿™æ ·æ‹¥æœ‰æ‰€æœ‰æƒçš„å€¼ï¼Œå…¶å€¼å°†è¢«ç§»åŠ¨è€Œå“ˆå¸Œ map ä¼šæˆä¸ºè¿™äº›å€¼çš„æ‰€æœ‰è€…ã€‚

```rust
let field_name = String::from("Red");
let field_value = String::from("10");
let mut map = HashMap::new();
// field_name å’Œ field_value ä¸å†æœ‰æ•ˆï¼Œ
map.insert(field_name, field_value);
```

è‹¥å°†å€¼çš„å¼•ç”¨æ’å…¥å“ˆå¸Œ mapï¼Œè¿™äº›å€¼æœ¬èº«ä¸ä¼šè¢«ç§»è¿›å“ˆå¸Œ mapï¼Œä½†æ˜¯è¿™äº›å¼•ç”¨æŒ‡å‘çš„å€¼å¿…é¡»è‡³å°‘åœ¨å“ˆå¸Œ map æœ‰æ•ˆæ—¶ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚

### è¯»å–

å°†é”®åä½œä¸ºç´¢å¼•æ¥è·å–å€¼ï¼š

```rust
assert_eq!(10, scores["Red"]);
```

å°†é”®åä½œä¸ºç´¢å¼•æ—¶ï¼Œå¦‚æœè¢«ç´¢å¼•çš„é”®ä¸åœ¨å“ˆå¸Œ map ä¸­ï¼Œåœ¨ç¼–è¯‘æ—¶ä¸ä¼šæŠ¥é”™ï¼Œä½†è¿è¡Œæ—¶ä¼šå‘ç”Ÿ panicã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ `get` æ–¹æ³•å¹¶æä¾›å¯¹åº”çš„é”®æ¥ä»å“ˆå¸Œ map ä¸­è·å–å€¼ã€‚

```rust
let mut scores = HashMap::new();
scores.insert(String::from("Red"), 10);
scores.insert(String::from("Green"), 20);
let score = scores.get(&String::from("Red"));
```

`score` çš„å€¼åº”ä¸º `Some(10)`ï¼Œå› ä¸º `get` è¿”å› `Option`ï¼Œæ‰€ä»¥ç»“æœè¢«è£…è¿› `Some`ï¼›å¦‚æœæŸä¸ªé”®åœ¨å“ˆå¸Œ map ä¸­æ²¡æœ‰å¯¹åº”çš„å€¼ï¼Œ`get` ä¼šè¿”å› `None`ï¼Œè¿™æ—¶éœ€è¦ç”¨ match æ¥å¤„ç† `Option`ï¼Œå› æ­¤ä½¿ç”¨ `get` æ–¹æ³•ä¸ä¼šå‘ç”Ÿ panicã€‚

---

ä½¿ç”¨ `for` æ¥éå†å“ˆå¸Œ map ä¸­çš„æ¯ä¸€ä¸ªé”®å€¼å¯¹ï¼š

```rust
let mut scores = HashMap::new();
scores.insert(String::from("Red"), 10);
scores.insert(String::from("Green"), 20);
for (key, value) in &scores {
    println!("{key}: {value}");
}
```

`len` å’Œ `capacity` æ–¹æ³•æ¥æŸ¥çœ‹é•¿åº¦å’Œå®¹é‡ï¼š

```rust
println!("{}", scores.len());
println!("{}", scores.capacity());
```

`keys` å’Œ `values` æ–¹æ³•åˆ†åˆ«è¿”å›ä¸€ä¸ªé”®å’Œå€¼çš„è¿­ä»£å™¨ï¼š

```rust
let map = HashMap::from([
    ("a", 1),
    ("b", 2),
    ("c", 3),
]);

for key in map.keys() {
    println!("{key}");
}

for val in map.values() {
    println!("{val}");
}
```

`contains_key` æ–¹æ³•åˆ¤æ–­æ˜¯å¦å«æœ‰æŒ‡å®šé”®ï¼š

```rust
let map = HashMap::from([("a", 1)]);
assert_eq!(map.contains_key("a"), true);
```

### æ›´æ–°

é”®å€¼å¯¹çš„æ•°é‡å¯å¢é•¿ï¼Œä½†ä»»ä½•æ—¶å€™æ¯ä¸ªé”®åªèƒ½å…³è”ä¸€ä¸ªå€¼ã€‚å½“è¦æ›´æ–°å“ˆå¸Œ map ä¸­çš„æ•°æ®æ—¶ï¼Œå¿…é¡»å¤„ç†ä¸€ä¸ªé”®å·²ç»æœ‰å€¼äº†çš„æƒ…å†µã€‚

-   å¯ä»¥é€‰æ‹©ç”¨æ–°å€¼æ›¿ä»£æ—§å€¼ï¼›

-   å¯ä»¥é€‰æ‹©ä¿ç•™æ—§å€¼è€Œå¿½ç•¥æ–°å€¼ï¼Œå¹¶åœ¨é”®æ²¡æœ‰å¯¹åº”å€¼æ—¶å¢åŠ æ–°å€¼ï¼›

-   å¯ä»¥ç»“åˆæ–°æ—§ä¸¤å€¼ã€‚

å½“æ’å…¥äº†ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ¥ç€ç”¨ç›¸åŒçš„é”®æ’å…¥ä¸€ä¸ªä¸åŒçš„å€¼ï¼Œä¸è¿™ä¸ªé”®ç›¸å…³è”çš„æ—§å€¼å°†è¢«æ›¿æ¢ã€‚

```rust
let mut scores = HashMap::from([(String::from("Red"), 10)]);
// åŸå§‹å€¼ 10 è¢«è¦†ç›–
scores.insert(String::from("Red"), 20);

// å¯ä»¥å°†é”®å½“ä½œç´¢å¼•æ¥è·å–å€¼ï¼Œä½†ä¸èƒ½ä¿®æ”¹å€¼
scores["Red"] = 20;              // é”™è¯¯
println!("{}", scores["Red"]);   // æ­£ç¡®
```

æ£€æŸ¥æŸä¸ªç‰¹å®šçš„é”®æ˜¯å¦æœ‰å€¼ï¼Œè‹¥æ²¡æœ‰åˆ™æ’å…¥ä¸€ä¸ªå€¼ã€‚å“ˆå¸Œ map æœ‰ä¸€ä¸ª `entry` æ–¹æ³•ï¼Œå®ƒè·å–è¦æ£€æŸ¥çš„é”®ä½œä¸ºå‚æ•°ã€‚`entry` æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª `Entry` æšä¸¾ï¼Œå®ƒä»£è¡¨äº†å¯èƒ½å­˜åœ¨æˆ–ä¸å­˜åœ¨çš„å€¼ã€‚

```rust
let mut scores = HashMap::from([(String::from("Red"), 10)]);
scores.entry(String::from("Green")).or_insert(20);
// Red å·²å­˜åœ¨ï¼Œåˆ™ä¸æ’å…¥å€¼
scores.entry(String::from("Red")).or_insert(30);
```

`Entry` çš„ `or_insert` æ–¹æ³•åœ¨é”®å¯¹åº”çš„å€¼å­˜åœ¨æ—¶å°±è¿”å›è¿™ä¸ªå€¼çš„å¯å˜å¼•ç”¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å°†å‚æ•°ä½œä¸ºæ–°å€¼æ’å…¥å¹¶è¿”å›æ–°å€¼çš„å¯å˜å¼•ç”¨ã€‚

---

è¦æ‰¾åˆ°ä¸€ä¸ªé”®å¯¹åº”çš„å€¼å¹¶æ ¹æ®æ—§çš„å€¼æ›´æ–°å®ƒï¼Œå¦‚è®¡æ•°æ–‡æœ¬ä¸­æ¯ä¸€ä¸ªå•è¯åˆ†åˆ«å‡ºç°äº†å¤šå°‘æ¬¡ã€‚ä½¿ç”¨å“ˆå¸Œ map ä»¥å•è¯ä½œä¸ºé”®å¹¶é€’å¢å…¶å€¼æ¥è®°å½•é‡åˆ°è¿‡å‡ æ¬¡è¿™ä¸ªå•è¯ï¼Œè‹¥ç¬¬ä¸€æ¬¡çœ‹åˆ°æŸä¸ªå•è¯ï¼Œåˆ™æ’å…¥å€¼ `0`ã€‚

```rust
let text = "hello world hello ok 123 world hello";
let mut map = HashMap::new();
for word in text.split_whitespace() {
    let count = map.entry(word).or_insert(0);
    *count +=1;
}
println!("{:?}", map);
```

---

`clear` æ–¹æ³•æ¸…ç©ºå“ˆå¸Œ mapï¼Œ`is_empty` æ–¹æ³•åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼š

```rust
let mut map = HashMap::from([("a", 1)]);
map.clear();
assert!(map.is_empty());
```

`remove` å’Œ `remove_entry` æ–¹æ³•åˆ é™¤æŒ‡å®šé”®ã€‚å‰è€…è‹¥å­˜åœ¨æŒ‡å®šé”®ï¼Œåˆ™è¿”å›å¯¹åº”çš„å€¼ï¼Œåè€…è‹¥å­˜åœ¨æŒ‡å®šé”®ï¼Œåˆ™è¿”å›å¯¹åº”çš„é”®å’Œå€¼ç»„æˆçš„å…ƒç»„ï¼š

```rust
let mut map = HashMap::from([("a", 1)]);
assert_eq!(map.remove("a"), Some(1));
assert_eq!(map.remove("a"), None);
map.insert("a", 1);
assert_eq!(map.remove_entry("a"), Some(("a", 1)));
assert_eq!(map.remove("a"), None);
```

# 2 é”™è¯¯å¤„ç†

Rust æœ‰ä¸¤ç§é”™è¯¯ç±»åˆ«ï¼š**å¯æ¢å¤é”™è¯¯**å’Œ**ä¸å¯æ¢å¤é”™è¯¯**ã€‚å‰è€…é€šå¸¸ä»£è¡¨å‘ç”¨æˆ·æŠ¥å‘Šé”™è¯¯å¹¶é‡è¯•æ“ä½œï¼Œå¦‚æœªæ‰¾åˆ°æ–‡ä»¶ã€‚åè€…é€šå¸¸æ˜¯ Bugï¼Œå¦‚å°è¯•è®¿é—®è¶…è¿‡æ•°ç»„ç´¢å¼•çš„ä½ç½®ã€‚

å…¶å®ƒè¯­è¨€é€šå¸¸ä¸åŒºåˆ†è¿™ä¸¤ç±»ï¼Œè€Œæ˜¯é‡‡ç”¨å¼‚å¸¸å¤„ç†çš„æ–¹å¼ã€‚Rust æ²¡æœ‰å¼‚å¸¸ï¼Œä½†æœ‰å¯æ¢å¤é”™è¯¯ `Result<T, E>` å’Œä¸å¯æ¢å¤é”™è¯¯ `panic!`ã€‚

## panic! ä¸ä¸å¯æ¢å¤é”™è¯¯

å½“æ‰§è¡Œ `panic!` å®æ—¶ï¼Œä¼šæ‰“å°å‡ºé”™è¯¯ä¿¡æ¯ï¼Œå±•å¼€å¹¶æ¸…ç†æ ˆæ•°æ®ï¼Œç„¶åé€€å‡ºã€‚å‡ºç°è¿™ç§æƒ…å†µçš„åœºæ™¯é€šå¸¸æ˜¯æ£€æµ‹åˆ°ä¸€äº›ç±»å‹çš„ Bugï¼Œè€Œç¨‹åºå¹¶ä¸æ¸…æ¥šè¯¥å¦‚ä½•å¤„ç†ã€‚

å½“å‡ºç° panic æ—¶ï¼Œç¨‹åºé»˜è®¤ä¼šè¿›è¡Œ**æ ˆå±•å¼€**ã€‚Rust ä¼šå›æº¯æ ˆå¹¶æ¸…ç†å®ƒé‡åˆ°çš„æ¯ä¸€ä¸ªå‡½æ•°çš„æ•°æ®ã€‚å¦ä¸€ç§æ˜¯ç›´æ¥**ç»ˆæ­¢**ï¼Œè¿™ä¼šä¸æ¸…ç†æ•°æ®å°±é€€å‡ºç¨‹åºï¼Œç¨‹åºæ‰€ä½¿ç”¨çš„å†…å­˜ç”±æ“ä½œç³»ç»Ÿæ¥æ¸…ç†ã€‚é€šè¿‡åœ¨ *Cargo.toml* çš„ `[profile]` éƒ¨åˆ†å¢åŠ  `panic = "abort"`ï¼Œå¯åœ¨ panic æ—¶ç”±æ ˆå±•å¼€åˆ‡æ¢ä¸ºç»ˆæ­¢ã€‚

```toml
[profile.release]
panic = "abort"
```

**æ–‡ä»¶ï¼šmain.rs**

```rust
panic!("Crash here!");
```

è¾“å‡ºåŒ…å« `panic!` è°ƒç”¨é€ æˆçš„é”™è¯¯ä¿¡æ¯ã€‚ç¬¬ä¸€è¡Œæ˜¾ç¤ºäº† panic æä¾›çš„ä¿¡æ¯å¹¶æŒ‡æ˜äº†æºç ä¸­ panic å‡ºç°çš„ä½ç½®ã€‚

```rust
thread 'main' panicked at 'Crash here!', src\main.rs:2:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
error: process didn't exit successfully: 
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¢«æŒ‡æ˜çš„é‚£ä¸€è¡Œæ˜¯ä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œä¸”æŸ¥çœ‹è¿™ä¸€è¡Œçš„è¯ä¼šå‘ç° `panic!` å®çš„è°ƒç”¨ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œ`panic!` å¯èƒ½ä¼šå‡ºç°åœ¨ä»£ç æ‰€è°ƒç”¨çš„ä»£ç ä¸­ã€‚é”™è¯¯ä¿¡æ¯æŠ¥å‘Šçš„æ–‡ä»¶åå’Œè¡Œå·å¯èƒ½æŒ‡å‘å…¶å®ƒä»£ç ä¸­çš„ `panic!` å®è°ƒç”¨ï¼Œè€Œä¸æ˜¯æ­¤ä»£ç ä¸­æœ€ç»ˆå¯¼è‡´ `panic!` çš„é‚£ä¸€è¡Œã€‚

### ä½¿ç”¨ panic! çš„ backtrace

å¯ä»¥é€šè¿‡ panic æ—¶ï¼Œè¢«è°ƒå‡½æ•°çš„ backtrace æ¥å¯»æ‰¾å…·ä½“å‡ºé—®é¢˜çš„åœ°æ–¹ã€‚

```rust
let v = vec![1, 2, 3];
v[9];
```

å°è¯•è®¿é—® vector çš„ç¬¬ 10 ä¸ªå…ƒç´ ï¼Œè¶Šç•Œä¼šå¯¼è‡´ panicã€‚`[]` åº”å½“è¿”å›ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥ä¼ é€’äº†ä¸€ä¸ªæ— æ•ˆç´¢å¼•ï¼Œåˆ™æ²¡æœ‰å¯ä¾› Rust è¿”å›çš„æ­£ç¡®çš„å…ƒç´ ã€‚

é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æ¥è®¾ç½® backtraceï¼š

```shell
# Windows Powershell
$env:RUST_BACKTRACE=1; cargo run

# Windows CMD
set RUST_BACKTRACE=1 && cargo run

# Linux
RUST_BACKTRACE=1 cargo run
```

ç„¶åå°±å¯ä»¥çœ‹åˆ°å¸¦æœ‰ backtrace çš„é”™è¯¯ä¿¡æ¯ï¼š

```
thread 'main' panicked at 'index out of bounds: the len is 3 but the index is 9', src\main.rs:3:5
stack backtrace:
   0: std::panicking::begin_panic_handler
             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\/library\std\src\panicking.rs:498 
   1: core::panicking::panic_fmt
             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\/library\core\src\panicking.rs:116
   2: core::panicking::panic_bounds_check
             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\/library\core\src\panicking.rs:84
   3: core::slice::index::impl$2::index<i32>
             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\library\core\src\slice\index.rs:189
   4: core::slice::index::impl$0::index<i32,usize>
             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\library\core\src\slice\index.rs:15
   5: alloc::vec::impl$15::index<i32,usize,alloc::alloc::Global>
             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\library\alloc\src\vec\mod.rs:2520
   6: exp::main
             at .\src\main.rs:3
   7: core::ops::function::FnOnce::call_once<void (*)(),tuple$<> >
             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\library\core\src\ops\function.rs:227
```

åœ¨ Debug ä¸‹æ‰èƒ½è·å–å¸¦æœ‰è¿™äº›ä¿¡æ¯çš„ backtraceï¼Œå…¶ä¸­ç¬¬ 6 ä¸ªæŒ‡å‘äº† *src/main.rs* çš„ç¬¬ 3 è¡Œï¼Œå¯ä»¥æ ¹æ®è¿™äº›å›æº¯ä¿¡æ¯æ¥å®šä½é”™è¯¯ã€‚

## Result ä¸å¯æ¢å¤çš„é”™è¯¯

å¤§éƒ¨åˆ†é”™è¯¯å¹¶æ²¡æœ‰ä¸¥é‡åˆ°éœ€è¦ç¨‹åºå®Œå…¨åœæ­¢æ‰§è¡Œã€‚Rust ä¸­æœ‰ä¸€ä¸ª `Result` æšä¸¾ï¼Œå®šä¹‰æœ‰ `Ok` å’Œ `Err` è¿™ä¸¤ä¸ªæˆå‘˜ï¼š

```rust
enum Result<T, E> {
    Ok(T),
    Err(E),
}
```

`T` å’Œ `E` æ˜¯æ³›å‹ç±»å‹å‚æ•°ï¼Œ`T` ä»£è¡¨æˆåŠŸæ—¶è¿”å›çš„ `Ok` æˆå‘˜ä¸­çš„æ•°æ®ç±»å‹ï¼Œè€Œ `E` ä»£è¡¨å¤±è´¥æ—¶è¿”å›çš„ `Err` æˆå‘˜ä¸­çš„æ•°æ®ç±»å‹ã€‚å› æ­¤å¯ä»¥å°† `Result` ç±»å‹å’Œæ ‡å‡†åº“ä¸­ä¸ºå…¶å®šä¹‰çš„å‡½æ•°ç”¨äºå¤šç§åœºæ™¯ï¼Œè¿™äº›æƒ…å†µä¸­éœ€è¦è¿”å›çš„æˆåŠŸå€¼å’Œå¤±è´¥å€¼å¯èƒ½ä¼šå„ä¸ç›¸åŒã€‚

```rust
use std::fs::File;

fn main() {
    let f = match File::open("hello.txt") {
        Ok(file) => file,
        Err(error) => panic!("Problem opening the file: {:?}", error),
    };
}
```

è¿™é‡Œä½¿ç”¨ match è¡¨è¾¾å¼æ¥å¤„ç† `File::open` æ‰€è¿”å›çš„å€¼ï¼Œè¯¥å‡½æ•°ä¼šæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ª `Result<T, E>`ã€‚æ³›å‹å‚æ•° `T` è¡¨ç¤ºæˆåŠŸå€¼çš„ç±»å‹ `std::fs::File`ï¼Œå¤±è´¥å€¼ `E` çš„ç±»å‹æ˜¯ `std::io::Error`ã€‚`Result` æšä¸¾å¯ä»¥æä¾›è¿™äº›ä¿¡æ¯ï¼ŒæˆåŠŸåˆ™è¿”å›ä¸€ä¸ªåŒ…å«æ–‡ä»¶å¥æŸ„çš„ `Ok` å®ä¾‹ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ä¿¡æ¯çš„ `Err` å®ä¾‹ï¼Œå¦‚æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ²¡æœ‰è®¿é—®æƒé™ç­‰ã€‚

### åŒ¹é…ä¸åŒçš„é”™è¯¯

å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¹¶ä¸æ˜¯ä»»ä½•é”™è¯¯éƒ½å°†ç¨‹åº panicï¼Œè€Œæ˜¯æ ¹æ®é”™è¯¯ç±»å‹æ¥è¿›è¡Œä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œå› æ­¤å¯ä»¥ç”¨ `match` è¡¨è¾¾å¼åŒ¹é…ä¸åŒçš„é”™è¯¯ã€‚

```rust
use std::fs::File;
use std::io::ErrorKind;

fn main() {
    let f = match File::open("hello.txt") {
        Ok(file) => file,
        Err(error) => match error.kind() {
            ErrorKind::NotFound => match File::create("hello.txt") {
                Ok(fc) => fc,
                Err(e) => panic!("Problem creating the file: {:?}", e),
            },
            _ => panic!("Problem opening the file: {:?}", error),
        },
    };
}
```

`File::open` è¿”å›çš„ `Err` æˆå‘˜ä¸­çš„å€¼ç±»å‹ `io::Error`ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ‡å‡†åº“ä¸­æä¾›çš„ç»“æ„ä½“ã€‚è¿™ä¸ªç»“æ„ä½“æœ‰ä¸€ä¸ªè¿”å› `io::ErrorKind` å€¼çš„ `kind` æ–¹æ³•å¯ä¾›è°ƒç”¨ã€‚`io::ErrorKind` æ˜¯ä¸€ä¸ªæ ‡å‡†åº“æä¾›çš„æšä¸¾ï¼Œå®ƒçš„æˆå‘˜å¯¹åº” `io` æ“ä½œå¯èƒ½å¯¼è‡´çš„ä¸åŒé”™è¯¯ç±»å‹ã€‚è¿™é‡Œåªå¤„ç† `ErrorKind::NotFound`ï¼Œè¡¨ç¤ºæ–‡ä»¶å¹¶ä¸å­˜åœ¨ã€‚

å†…å±‚ `match` ä¸­æ£€æŸ¥çš„æ¡ä»¶æ˜¯ `error.kind()` çš„è¿”å›å€¼æ˜¯å¦ä¸º `ErrorKind`çš„ `NotFound` æˆå‘˜ã€‚å¦‚æœæ˜¯ï¼Œåˆ™å°è¯•é€šè¿‡ `File::create` åˆ›å»ºæ–‡ä»¶ã€‚ä½†åˆ›å»ºæ–‡ä»¶ä¹Ÿå¯èƒ½ä¼šå¤±è´¥ï¼Œå› æ­¤è¿˜éœ€è¦å†å¢åŠ ä¸€ä¸ªå†…å±‚ `match`ã€‚å½“æ–‡ä»¶ä¸èƒ½è¢«æ‰“å¼€ï¼Œä¼šæ‰“å°å‡ºä¸€ä¸ªä¸åŒçš„é”™è¯¯ä¿¡æ¯ã€‚å¤–å±‚ `match` çš„æœ€åä¸€ä¸ªåˆ†æ”¯ä¿æŒä¸å˜ï¼Œè¿™æ ·å¯¹ä»»ä½•é™¤äº†æ–‡ä»¶ä¸å­˜åœ¨çš„é”™è¯¯ä¼šä½¿ç¨‹åº panicã€‚

### unwrap å’Œ expect

é¢‘ç¹çš„ä½¿ç”¨ `match` ä¼šæ˜¾å¾—ååˆ†å†—é•¿è€Œç¹çã€‚`Result<T, E>` ç±»å‹å®šä¹‰äº†å¾ˆå¤šè¾…åŠ©æ–¹æ³•æ¥å¤„ç†å„ç§æƒ…å†µã€‚å…¶ä¸­ä¹‹ä¸€å«åš `unwrap`ï¼Œè‹¥ `Result` å€¼æ˜¯æˆå‘˜ `Ok`ï¼Œ`unwrap` ä¼šè¿”å› `Ok` ä¸­çš„å€¼ã€‚è‹¥ `Result` æ˜¯æˆå‘˜ `Err`ï¼Œ`unwrap` ä¼šç›´æ¥è°ƒç”¨ `panic!`ã€‚

```rust
let f = File::open("hello.txt").unwrap();
```

å‘ç”Ÿé”™è¯¯æ—¶ `unwrap` ä¼šç›´æ¥å¯¼è‡´ panicï¼Œä¸”æ²¡æœ‰é¢å¤–çš„é”™è¯¯ä¿¡æ¯ã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨ `expect`ï¼Œå®ƒçš„è¡Œä¸ºä¸ `unwrap`ï¼Œä½†å¯ä»¥æä¾›é¢å¤–çš„ä¿¡æ¯ã€‚

```rust
let f = File::open("hello.txt").expect("Failed to open hello.txt");
```

>   å½“ä½¿ç”¨ unwrap æˆ– expect æ—¶ï¼Œå°±ç›¸å½“äºä¸ç®¡å‘ç”Ÿä»€ä¹ˆç±»å‹çš„é”™è¯¯ï¼Œéƒ½åªä¼šå‘ç”Ÿ panicï¼Œè€Œä¸æ˜¯æ ¹æ®é”™è¯¯ç±»å‹æ¥è¿›è¡Œå¤„ç†ã€‚

### ä¼ æ’­é”™è¯¯

å½“ä¸€ä¸ªå‡½æ•°å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯æ—¶ï¼Œé™¤äº†åœ¨è¿™ä¸ªå‡½æ•°ä¸­å¤„ç†å¤–ï¼Œè¿˜å¯ä»¥é€‰æ‹©è®©è°ƒç”¨è€…æ¥å¤„ç†ï¼Œç§°ä¸º**ä¼ æ’­é”™è¯¯**ã€‚è¿™æ ·èƒ½æ›´å¥½çš„æ§åˆ¶ä»£ç è°ƒç”¨ï¼Œå› ä¸ºè°ƒç”¨è€…å¯èƒ½æ¯”è¢«è°ƒç”¨è€…æ‹¥æœ‰æ›´å¤šä¿¡æ¯æˆ–é€»è¾‘æ¥å†³å®šåº”è¯¥å¦‚ä½•å¤„ç†é”™è¯¯ã€‚

è¦ä¼ æ’­é”™è¯¯ï¼Œå¯ä»¥å°†é”™è¯¯è¿”å›ï¼š

```rust
use std::fs::File;
use std::io::{self, Read};

fn main() {
    let s = read_content("hello.txt").unwrap();
    println!("{}", s);
}

fn read_content(path: &str) -> Result<String, io::Error> {
    let mut f = match File::open(path) {
        Ok(file) => file,
        Err(error) => return Err(error),
    };

    let mut s = String::new();
    match f.read_to_string(&mut s) {
        Ok(_) => Ok(s),
        Err(e) => Err(e),
    }
}
```

è¯¥å‡½æ•°è¿”å›ä¸€ä¸ª `Result<String, io::Error>` ç±»å‹çš„å€¼ã€‚è‹¥æ²¡æœ‰ä»»ä½•é”™è¯¯å¹¶æˆåŠŸè¿”å›ï¼Œåˆ™è°ƒç”¨è€…ä¼šæ”¶åˆ°ä¸€ä¸ªåŒ…å« `String` çš„ `Ok` å€¼ã€‚è‹¥é‡åˆ°ä»»ä½•é”™è¯¯ï¼Œåˆ™è°ƒç”¨è€…ä¼šæ”¶åˆ°ä¸€ä¸ªåŒ…å« `io::Error` çš„ `Err` å€¼ã€‚`File::open` å’Œ `read_to_string` éƒ½è¿”å› `io::Error` ç±»å‹çš„é”™è¯¯å€¼ã€‚

æ¥ç€ä½¿ç”¨ `match` å¤„ç† `File::open` è¿”å›çš„ `Result`ã€‚å¦‚æœé”™è¯¯ï¼Œåˆ™è¿”å› `Err` å®ä¾‹ã€‚`read_to_string` æ–¹æ³•ä¹Ÿè¿”å›ä¸€ä¸ª `Result`ï¼ŒåŒæ ·ä½¿ç”¨ `match` æ¥å¤„ç†ã€‚

### ç®€åŒ–ä¼ æ’­é”™è¯¯

ä½¿ç”¨ä¼ æ’­é”™è¯¯çš„æ¨¡å¼ååˆ†å¸¸è§ï¼Œå› æ­¤ Rust æä¾›äº† `?`  è¿ç®—ç¬¦æ¥ç®€åŒ–ã€‚

```rust
fn read_content(path: &str) -> Result<String, io::Error> {
    let mut f = File::open(path)?;
    let mut s = String::new();
    f.read_to_string(&mut s)?;
    Ok(s)
}
```

`Result` å€¼ä¹‹åçš„ `?` è¿ç®—ç¬¦è¢«å®šä¹‰ä¸ºä¸ä½¿ç”¨ `match` è¡¨è¾¾å¼æœ‰ç€å®Œå…¨ç›¸åŒçš„å¤„ç†æ–¹å¼ã€‚è‹¥ `Result` çš„å€¼ä¸º `Ok`ï¼Œåˆ™ä¼šè¿”å› `Ok` ä¸­çš„å€¼è€Œç¨‹åºå°†ç»§ç»­æ‰§è¡Œã€‚è‹¥å€¼ä¸º `Err`ï¼Œåˆ™ä½¿ç”¨ `Err` ä½œä¸ºè¿”å›å€¼ä»å‡½æ•°ä¸­æå‰è¿”å›ã€‚

ä¸ä½¿ç”¨ `match` ä¸åŒçš„æ˜¯ï¼Œ`?` è¿ç®—ç¬¦æ‰€ä½¿ç”¨æ¥æ”¶çš„é”™è¯¯å€¼è¢«ä¼ é€’ç»™äº† `from` å‡½æ•°ï¼Œå®ƒå®šä¹‰äºæ ‡å‡†åº“çš„ `From` trait ä¸­ï¼Œå…¶ç”¨æ¥å°†é”™è¯¯ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚å½“ `?` è¿ç®—ç¬¦è°ƒç”¨ `from` å‡½æ•°æ—¶ï¼Œæ”¶åˆ°çš„é”™è¯¯ç±»å‹è¢«è½¬æ¢ä¸º**ç”±å½“å‰å‡½æ•°è¿”å›ç±»å‹æ‰€æŒ‡å®šçš„é”™è¯¯ç±»å‹**ã€‚è¿™åœ¨å½“å‡½æ•°è¿”å›å•ä¸ªé”™è¯¯ç±»å‹æ¥ä»£è¡¨æ‰€æœ‰å¯èƒ½å¤±è´¥çš„æ–¹å¼æ—¶ååˆ†æœ‰æ•ˆï¼Œå³ä½¿å…¶å¯èƒ½ä¼šå› å¾ˆå¤šç§åŸå› å¤±è´¥ã€‚åªè¦æ¯ä¸€ä¸ªé”™è¯¯ç±»å‹éƒ½å®ç°äº† `from` å‡½æ•°æ¥å®šä¹‰å¦‚ä½•å°†è‡ªèº«è½¬æ¢ä¸ºè¿”å›çš„é”™è¯¯ç±»å‹ï¼Œ`?` è¿ç®—ç¬¦ä¼šè‡ªåŠ¨å¤„ç†è¿™äº›è½¬æ¢ã€‚

è¿˜å¯ä»¥åœ¨ `?` ä¹‹åä½¿ç”¨é“¾å¼æ–¹æ³•è°ƒç”¨æ¥è¿›ä¸€æ­¥ç®€åŒ–ä»£ç ï¼š

```rust
fn read_content(path: &str) -> Result<String, io::Error> {
    let mut s = String::new();
    File::open(path)?.read_to_string(&mut s)?;
    Ok(s)
}
```

`File::open(path)?` ç›´æ¥é“¾å¼è°ƒç”¨äº† `read_to_string`ã€‚ä»ç„¶éœ€è¦ `read_to_string` è°ƒç”¨ç»“å°¾çš„ `?`ï¼Œè€Œä¸”å½“ `File::open` å’Œ `read_to_string` éƒ½æˆåŠŸæ²¡æœ‰å¤±è´¥æ—¶è¿”å›åŒ…å«ç”¨æˆ·å `s` çš„ `Ok` å€¼ã€‚

---

å°†æ–‡ä»¶è¯»å–åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ç›¸å½“å¸¸è§çš„æ“ä½œï¼Œæ‰€ä»¥æ ‡å‡†åº“æä¾›äº†åä¸º `fs::read_to_string` çš„å‡½æ•°ï¼Œå®ƒä¼šæ‰“å¼€æ–‡ä»¶ã€æ–°å»ºä¸€ä¸ª `String`ã€è¯»å–æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†å†…å®¹æ”¾å…¥ `String` å¹¶è¿”å›ã€‚

```rust
fn read_content(path: &str) -> Result<String, io::Error> {
    fs::read_to_string(path)
}
```

---

`?` è¿ç®—ç¬¦åªèƒ½è¢«ç”¨äºè¿”å›å€¼ä¸ `?` ä½œç”¨çš„å€¼ç›¸å…¼å®¹çš„å‡½æ•°ï¼Œå› ä¸º `?` è¿ç®—ç¬¦è¢«å®šä¹‰ä¸ºä»å‡½æ•°ä¸­æå‰è¿”å›ä¸€ä¸ªå€¼ï¼Œå¦‚æœè¦åœ¨ `main` å‡½æ•°ä¸­ä½¿ç”¨ï¼Œéœ€è¦ä¿®æ”¹å…¶è¿”å›å€¼ã€‚`main` å‡½æ•°æ˜¯å¯æ‰§è¡Œç¨‹åºçš„å…¥å£ç‚¹å’Œé€€å‡ºç‚¹ï¼Œä¸ºäº†ä½¿ç¨‹åºèƒ½æ­£å¸¸å·¥ä½œï¼Œå¯ä»¥è¿”å›çš„ç±»å‹æ˜¯æœ‰é™åˆ¶çš„ï¼Œä½†å¯ä»¥è¿”å› `Result<(), E>`ã€‚

```rust
fn main() -> Result<(), io::Error> {
    let f = File::open("hello")?;
    Ok(())
}
```

`?` ä¹Ÿå¯ç”¨äº `Option<T>` å€¼ï¼ŒåŒæ ·åªèƒ½åœ¨è¿”å› `Option` çš„å‡½æ•°ä¸­ä½¿ç”¨ã€‚åœ¨ `Option<T>` ä¸Šè°ƒç”¨ `?` è¿ç®—ç¬¦çš„è¡Œä¸ºä¸ `Result<T, E>` ç±»ä¼¼ï¼šè‹¥å€¼æ˜¯ `None`ï¼Œæ­¤æ—¶ `None` ä¼šä»å‡½æ•°ä¸­æå‰è¿”å›ï¼›è‹¥å€¼æ˜¯ `Some`ï¼Œ`Some` ä¸­çš„å€¼ä½œä¸ºè¡¨è¾¾å¼çš„è¿”å›å€¼ï¼Œå¹¶ç»§ç»­æ‰§è¡Œã€‚

```rust
fn plus_one(n: Option<i32>) -> Option<i32> {
    Some(n? + 1)
}
```

